<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>瀑布流布局</title>
    <script src="jquery-3.2.1.min.js"></script>
	<style>
		html,body,ul,li,p,h1,h2,h3,h4,h5,h6 {
                padding:0px;
                margin:0px;
    }
    ul,li {
        list-style:none;
    }
    a {
        text-decoration: none;
    }
    body {
    	width: 100%
        height:100%;
    	background-color: #ddd;
    	font-size: 15px;
    	font-family:'Open Sans Condensed','Arial Narrow',serif;
    	min-width: 700px;

    }
    .container {
    	width: 100%;
    	position: relative;
    }
    #header {
    	margin: 30px 0;
    	text-align: center;
    }
    #header h3 {
    	margin-bottom: 10px;
    	color: rgba(42,23,23,0.43);
    }
    #header p {
    	margin-bottom: 15px;
    	color: rgba(0,0,0,0.39);
    }
    #header ul {
    	width: 100%;
    	margin: 0 auto;
    }
    #header ul li {
    	display: inline-block;
    	height: 20px;
    	line-height: 20px;
    	text-align: center;
    	margin-left: 5px;
    	padding: 5px;
    	border: 1px solid #fff;
    	background-color: rgba(255,0,0,0.02);
    }
    #header ul li a {
    	color:#C6A1A1;
        /*font-style:oblique; */
    }
    #header li:hover {
    	background-color: rgba(255,255,255,0.5);
    }
    #main {position: relative;}
    .pin{padding:15px 0 0 15px;float: left;}
    .box{padding:10px;
                 border: 1px solid #ccc;
                 border-radius:5px;
                 box-shadow: 0 0 6px #ccc;
    }
    .box img{
        width:162px;
        height:auto;
    }
	</style>
</head>
<body>
<div class="container">
<div id="header">
  <h3>jqurey的常见特效--瀑布流布局</h3>
  <p>用瀑布流布局摆放图片，实现无限瀑布流</p>
  <ul>
    <li><a href="jquery.html">懒加载</a></li>
    <li><a href="jquery2.html">tab切换</a></li>     	
    <li><a href="jquery3.html">瀑布流布局</a></li>     	
    <li><a href="jquery4.html">回到顶部</a></li>     	
    <li><a href="jquery5.html">固定顶部</a></li>     	
  </ul>
</div> 
<div id="main">
        <div class="pin">
            <div class="box"><img src="image/12.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/22.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/32.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/14.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/15.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/17.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/18.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/19.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/19.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/12.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/13.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/14.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/13.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/14.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/15.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/16.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/17.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/18.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/19.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/20.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/21.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/22.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/23.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/24.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/25.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/26.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/27.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/28.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/29.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/30.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/31.jpg" alt=""></div>
        </div>
        <div class="pin">
            <div class="box"><img src="image/32.jpg" alt=""></div>
        </div>         
</div>
</div>
<script>
    // $(window).resize(function(){
    //   waterfall();
    // });
$( window ).on( "load", function(){
    waterfall();
    // waterfall('main','pin');
    var dataInt={'data':[{'src':'image/12.jpg'},{'src':'image/13.jpg'},{'src':'image/14.jpg'},{'src':'image/15.jpg'}]};
    window.onscroll=function(){
        if(checkscrollside()){
            $.each( dataInt.data, function( index, value ){
                var $oPin = $('<div>').addClass('pin').appendTo( $( "#main" ) );
                var $oBox = $('<div>').addClass('box').appendTo( $oPin );
                $('<img>').attr('src',$( value).attr( 'src') ).appendTo($oBox);
            });
            waterfall();
        };
    }
});

/*
    parend 父级id
    pin 元素id
*/
function waterfall(){
    var $aPin = $( "#main>div" );
    var iPinW = $aPin.eq( 0 ).outerWidth();// 一个块框pin的宽
    var num = Math.floor( $( window ).width() / iPinW );//每行中能容纳的pin个数【窗口宽度除以一个块框宽度】
    //oParent.style.cssText='width:'+iPinW*num+'px;ma rgin:0 auto;';//设置父级居中样式：定宽+自动水平外边距
    $( "#main" ).width(iPinW*num).css('margin','50px auto');

    var pinHArr=[];//用于存储 每列中的所有块框相加的高度。

    $aPin.each( function( index, value ){
        var pinH = $aPin.eq( index ).outerHeight();
        if( index < num ){
            pinHArr[ index ] = pinH; //第一行中的num个块框pin 先添加进数组pinHArr
        }else{
            var minH = Math.min.apply( null, pinHArr );//数组pinHArr中的最小值minH
            var minHIndex = $.inArray( minH, pinHArr );
            $( value ).css({
                'position': 'absolute',
                'top': minH + 'px',
                'left': minHIndex*iPinW+'px'
            });
            //数组 最小高元素的高 + 添加上的aPin[i]块框高
            pinHArr[ minHIndex ] += $aPin.eq( index ).outerHeight();//更新添加了块框后的列高
        }
    });
}

function checkscrollside(){
    var $aPin = $( "#main>div" );
    var lastPinH = $aPin.last().get(0).offsetTop + Math.floor($aPin.last().height()/2);//创建【触发添加块框函数waterfall()】的高度：最后一个块框的距离网页顶部+自身高的一半(实现未滚到底就开始加载)
    var scrollTop = $( window ).scrollTop()//注意解决兼容性
    var documentH = $( document ).width();//页面高度
    return (lastPinH < scrollTop + documentH ) ? true : false;//到达指定高度后 返回true，触发waterfall()函数
}
</script>
</body>
</html>